geom_point(height = 0,
width = 0.1,
shape = 1,
alpha = 0.5,
position = position_nudge(x=0.5))+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
ggplot(data_hill_long,
aes(x = Site,
y = diversity,
colour = Location))+
geom_point(shape = 1,
alpha = 0.5,
position = position_nudge(x=0.5))+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
ggplot(data_hill_long,
aes(x = Site,
y = diversity,
colour = Location))+
geom_point(shape = 1,
alpha = 0.5,
position = position_nudge(x=0.5))+
stat_summary(fun.data = "mean_cl_boot",
position = position_nudge(x=0.5))+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
ggplot(data_hill_long,
aes(x = Site,
y = diversity,
colour = Location,
group = Location))+
geom_point(shape = 1,
alpha = 0.5,
position = position_nudge(x=0.5))+
stat_summary(fun.data = "mean_cl_boot",
position = position_nudge(x=0.5))+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
data_hill_long$Location <- paste("Location: ", data_hill_long$Location, sep="")
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot",
position = position_nudge(x=0.5))+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_grid(Location~q)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_grid(Location~q)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
model1 <- lm(q0 ~ Site*Location,
data = data_hill)
plot <- data.frame(predicted = predict(model1),
residuals = residuals(model1)) |>
ggplot(aes(x=predicted,
y=residuals))+
geom_point()+
geom_hline(yintercept = 0,
colour = "red",
linetype = 2)+
theme_bw()+
xlab("Predicted values")+
ylab("Residuals")+
theme(axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)),
axis.text = element_text(colour="black"))
plot
model2 <- glm(q0 ~ Site*Location,
data = data_hill,
family = quasipoisson(link="log"))
plot <- data.frame(predicted = predict(model2),
residuals = residuals(model2)) |>
ggplot(aes(x=predicted,
y=residuals))+
geom_point()+
geom_hline(yintercept = 0,
colour = "red",
linetype = 2)+
theme_bw()+
xlab("Predicted values")+
ylab("Pearson residuals")+
theme(axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)),
axis.text = element_text(colour="black"))
plot
output <- summary(model2)
output
#| eval: true
#| echo: true
#| warning: false
#| message: false
null_deviance <- summary(model2)$null.deviance
residual_deviance <- summary(model2)$deviance
explained_deviance <- 100*(null_deviance-residual_deviance)/null_deviance
explained_deviance
table <- Anova(model2)
table
data_plot <- data |>
filter(Species != "Deadwood") |>
filter(Species != "Bare_ground") |>
filter(Species != "Litter") |>
group_by(Site, Plot, Species) |>
summarise(Avg_cover = mean(Cover)) |>
mutate(Site = as.factor(Site),
Location = as.factor(Location)) |>
pivot_wider(names_from = Species,
values_from = Avg_cover,
values_fill = 0)
data_plot <- data |>
filter(Species != "Deadwood") |>
filter(Species != "Bare_ground") |>
filter(Species != "Litter") |>
group_by(Site, Plot, Species) |>
summarise(Avg_cover = mean(Cover)) |>
mutate(Site = as.factor(Site)) |>
pivot_wider(names_from = Species,
values_from = Avg_cover,
values_fill = 0)
data_plot <- data_plot |>
mutate(Total = sum(c_across(Acer_pseudoplatanus:Myrica_gale)))
data_plot <- data_plot |>
pivot_longer(cols = Acer_pseudoplatanus:Myrica_gale,
names_to = "Species",
values_to = "Abundance") |>
filter(Abundance > 0)
data_plot <- data_plot |>
mutate(Rel_abundance = Abundance/Total)
data_hill <- data_plot |>
group_by(Site, Plot) |>
summarise(q0=sum(Rel_abundance^0)^(1/(1-0)),
q1=exp(-sum(Rel_abundance*log(Rel_abundance))),
q2=sum(Rel_abundance^2)^(1/(1-2)))
data_hill_long <- data_hill |>
pivot_longer(q0:q2,
names_to = "q",
names_prefix = "q",
names_transform = as.numeric,
values_to = "diversity")
data_hill_long$q <- paste("q=", data_hill_long$q, sep = "")
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
model1 <- lm(q0 ~ Site,
data = data_hill)
plot <- data.frame(predicted = predict(model1),
residuals = residuals(model1)) |>
ggplot(aes(x=predicted,
y=residuals))+
geom_point()+
geom_hline(yintercept = 0,
colour = "red",
linetype = 2)+
theme_bw()+
xlab("Predicted values")+
ylab("Residuals")+
theme(axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)),
axis.text = element_text(colour="black"))
plot
model2 <- glm(q0 ~ Site,
data = data_hill,
family = quasipoisson(link="log"))
plot <- data.frame(predicted = predict(model2),
residuals = residuals(model2)) |>
ggplot(aes(x=predicted,
y=residuals))+
geom_point()+
geom_hline(yintercept = 0,
colour = "red",
linetype = 2)+
theme_bw()+
xlab("Predicted values")+
ylab("Pearson residuals")+
theme(axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)),
axis.text = element_text(colour="black"))
plot
output <- summary(model2)
output
null_deviance <- summary(model2)$null.deviance
residual_deviance <- summary(model2)$deviance
explained_deviance <- 100*(null_deviance-residual_deviance)/null_deviance
explained_deviance
table <- Anova(model2)
table
table <- summary(emmeans(object = model2,
specs = "Site",
contr = "pairwise"),
type="response")
table
model3 <- glm(q1 ~ Site,
data = data_hill,
family = Gamma(link="log"))
model4 <- glm(q2 ~ Site,
data = data_hill,
family = Gamma(link="log"))
table3 <- summary(emmeans(object = model3,
specs = "Site",
contr = "pairwise"),
type="response")
table4 <- summary(emmeans(object = model4,
specs = "Site",
contr = "pairwise"),
type="response")
table3
table4
annotations <- data.frame(Site=rep(unique(data_hill_long$Site), 3),
q=rep(unique(data_hill_long$q), each=4),
y=rep(50, 12),
Label=c("a", "b", "b", "a",
"a", "b", "b", "a",
"a", "b", "b", "a"))
annotations
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
label=Label))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
annotations <- data.frame(Site=rep(unique(data_hill_long$Site), 3),
q=rep(unique(data_hill_long$q), each=4),
y=c(rep(50, 4),
rep(30, 4),
rep(20, 4)),
Label=c("a", "b", "b", "a",
"a", "b", "b", "a",
"a", "b", "b", "a"))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
annotations <- data.frame(Site=rep(unique(data_hill_long$Site), 3),
q=rep(unique(data_hill_long$q), each=4),
y=c(rep(50, 4),
rep(30, 4),
rep(23, 4)),
Label=c("a", "b", "b", "a",
"a", "b", "b", "a",
"a", "b", "b", "a"))
annotations <- data.frame(Site=rep(unique(data_hill_long$Site), 3),
q=rep(unique(data_hill_long$q), each=4),
y=c(rep(50, 4),
rep(30, 4),
rep(23, 4)),
Label=c("a", "b", "b", "a",
"a", "b", "b", "a",
"a", "b", "b", "a"))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.5)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_point(shape = 1,
alpha = 0.3)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_jitter(shape = 1,
alpha = 0.3,
height = 0,
width = 0.1)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
ggplot(data_hill_long,
aes(x = Site,
y = diversity))+
geom_jitter(shape = 1,
alpha = 0.3,
height = 0,
width = 0.2)+
stat_summary(fun.data = "mean_cl_boot")+
theme_bw()+
xlab("")+
ylab("Effective number of species")+
facet_wrap(~q, ncol=3)+
theme(axis.text.x = element_text(angle=90,
vjust = 0.5,
hjust = 1))+
scale_colour_viridis(discrete = TRUE)+
geom_text(data=annotations,
aes(y=y,
x=Site,
label=Label))
View(data_plot)
data_nmds <- data |>
filter(Species != "Deadwood") |>
filter(Species != "Bare_ground") |>
filter(Species != "Litter") |>
group_by(Site, Plot, Species) |>
summarise(Avg_cover = mean(Cover)) |>
mutate(Site = as.factor(Site)) |>
pivot_wider(names_from = Species,
values_from = Avg_cover,
values_fill = 0)
View(data_nmds)
set.seed(123)
nmds <- metaMDS(comm = data_nmds[,3:ncol(data_nmds)],
distance = "bray",
k = 2,
trymax = 100)
set.seed(123)
nmds <- metaMDS(comm = data_nmds[,3:ncol(data_nmds)],
distance = "bray",
k = 2,
trymax = 1000)
stressplot(nmds)
data_nmds <- cbind(data_nmds, nmds$points)
kable(head(data_nmds, 10))
data_nmds |>
ggplot(aes(x = MDS1,
y = MDS2,
colour = Site))+
geom_point(size=2)+
theme_bw()+
scale_colour_viridis(name = "Habitat type",
discrete = TRUE,
option = "D")+
theme(axis.text = element_text(colour="black"),
axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)))+
xlab("NMDS1")+
ylab("NMDS2")+
geom_text(data=data.frame(x=min(data_nmds$MDS1),
y=max(data_nmds$MDS2),
label=paste("Stress = ",
round(nmds$stress, 3),
sep="")),
aes(x = x,
y = y,
label = label),
hjust = 0.1,
vjust = 0,
inherit.aes = FALSE)
data_nmds |>
ggplot(aes(x = MDS1,
y = MDS2,
colour = Site))+
geom_point(size=3)+
theme_bw()+
scale_colour_viridis(name = "Habitat type",
discrete = TRUE,
option = "D")+
theme(axis.text = element_text(colour="black"),
axis.title.x = element_text(margin = margin(t=10)),
axis.title.y = element_text(margin = margin(r=10)))+
xlab("NMDS1")+
ylab("NMDS2")+
geom_text(data=data.frame(x=min(data_nmds$MDS1),
y=max(data_nmds$MDS2),
label=paste("Stress = ",
round(nmds$stress, 3),
sep="")),
aes(x = x,
y = y,
label = label),
hjust = 0.1,
vjust = 0,
inherit.aes = FALSE)
8/2.54
